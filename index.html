<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å…ƒæ°—å‡ºã›ã‚ˆã‚¬ãƒãƒ£</title>

  <style>
    :root{
      --text:#ffffff;
      --muted: rgba(255,255,255,.75);
      --panel: rgba(20,20,24,.55);
      --panel2: rgba(20,20,24,.35);
      --border: rgba(255,255,255,.18);
      --shadow: 0 10px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }

    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Segoe UI", sans-serif;
      background-image:
        linear-gradient(rgba(0,0,0,.50), rgba(0,0,0,.50)),
        url("assets/bg.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100svh;
    }

    /* ---------- layout ---------- */
    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 22px 16px 28px;
    }

    .title{
      margin: 14px 0 16px;
      font-size: clamp(28px, 5vw, 44px);
      letter-spacing: .06em;
      text-align:center;
      text-shadow: 0 2px 18px rgba(0,0,0,.45);
    }

    .subtitle{
      margin: 0 0 14px;
      text-align:center;
      color: var(--muted);
      font-size: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items: stretch;
    }
    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; gap: 14px; }
    }

    .card{
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      padding: 16px;
      position: relative;
      overflow: hidden;
    }

    .card h2{
      margin: 2px 0 12px;
      font-size: 22px;
      text-align:center;
      letter-spacing: .04em;
    }

    .row{
      display:flex;
      gap: 14px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    /* ---------- buttons ---------- */
    .btn-round{
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.92);
      color: #111;
      border-radius: 999px;
      width: 90px;
      height: 90px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight: 800;
      letter-spacing: .04em;
      cursor:pointer;
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn-round:active{ transform: scale(.96); }
    .btn-round:hover{ filter: brightness(1.02); }
    @media (max-width: 760px){
      .btn-round{ width: 74px; height: 74px; font-size: 14px; }
    }

    .btn-pill{
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.12);
      color: var(--text);
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight: 700;
      letter-spacing: .03em;
      transition: transform .12s ease, background .12s ease;
      user-select:none;
    }
    .btn-pill:hover{ background: rgba(255,255,255,.16); }
    .btn-pill:active{ transform: scale(.98); }

    .btn-play{
      appearance:none;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.92);
      color:#111;
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      font-weight: 800;
      letter-spacing: .02em;
      user-select:none;
      display:none;
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
    }
    .btn-play.show{ display:inline-flex; align-items:center; gap:8px; }

    /* ---------- result box ---------- */
    .result{
      margin-top: 10px;
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      padding: 14px 12px;
      min-height: 92px;
      display:flex;
      flex-direction: column;
      justify-content:center;
      align-items:center;
      gap: 8px;
      text-align:center;
      position: relative;
      overflow:hidden;
    }

    .result .rarity{
      font-weight: 900;
      letter-spacing: .08em;
      font-size: 13px;
      opacity: .95;
    }
    .result .name{
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .03em;
      text-shadow: 0 2px 10px rgba(0,0,0,.25);
    }

    /* ---------- rarity themes + effects ---------- */
    .fx{
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity .2s ease;
    }

    .result.normal  { }
    .result.rare    { border-color: rgba(120,200,255,.35); }
    .result.srare   { border-color: rgba(170,130,255,.38); }
    .result.ssrare  { border-color: rgba(255,200,90,.40); }
    .result.ultra   { border-color: rgba(255,90,160,.45); }

    .result.rare   .fx,
    .result.srare  .fx,
    .result.ssrare .fx,
    .result.ultra  .fx{ opacity:1; }

    /* Rare: soft shimmer */
    .fx.rare{
      background:
        radial-gradient(circle at 20% 30%, rgba(120,200,255,.22), transparent 45%),
        radial-gradient(circle at 80% 70%, rgba(120,200,255,.18), transparent 50%);
      filter: blur(0px);
      animation: floaty 3.5s ease-in-out infinite;
    }

    /* S Rare: purple sparkle */
    .fx.srare{
      background:
        radial-gradient(circle at 30% 35%, rgba(170,130,255,.25), transparent 50%),
        radial-gradient(circle at 70% 65%, rgba(210,160,255,.18), transparent 55%),
        linear-gradient(120deg, transparent 0%, rgba(200,170,255,.12) 35%, transparent 70%);
      animation: shimmer 2.2s ease-in-out infinite;
    }

    /* SS Rare: gold sweep */
    .fx.ssrare{
      background:
        linear-gradient(120deg, transparent 0%, rgba(255,230,140,.10) 25%, rgba(255,230,140,.22) 50%, rgba(255,230,140,.10) 75%, transparent 100%),
        radial-gradient(circle at 75% 35%, rgba(255,200,90,.18), transparent 55%);
      animation: sweep 1.3s ease-in-out infinite;
      mix-blend-mode: screen;
    }

    /* Ultra: big flash + hearts/sparkles vibe */
    .fx.ultra{
      background:
        radial-gradient(circle at 50% 30%, rgba(255,120,200,.30), transparent 55%),
        radial-gradient(circle at 20% 75%, rgba(255,230,140,.18), transparent 60%),
        radial-gradient(circle at 80% 75%, rgba(120,220,255,.16), transparent 60%),
        linear-gradient(120deg, transparent 0%, rgba(255,255,255,.10) 40%, transparent 80%);
      animation: ultraPulse 1.1s ease-in-out infinite;
      mix-blend-mode: screen;
    }

    @keyframes floaty{
      0%,100%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
    }
    @keyframes shimmer{
      0%,100%{ transform: translateX(0); opacity:.95; }
      50%{ transform: translateX(6px); opacity:1; }
    }
    @keyframes sweep{
      0%{ transform: translateX(-12%); opacity:.8; }
      50%{ transform: translateX(12%); opacity:1; }
      100%{ transform: translateX(-12%); opacity:.8; }
    }
    @keyframes ultraPulse{
      0%,100%{ transform: scale(1); opacity:1; }
      50%{ transform: scale(1.02); opacity:1; }
    }

    /* ultra guaranteed animation overlay */
    .overlay{
      position: fixed;
      inset: 0;
      pointer-events:none;
      opacity:0;
      transition: opacity .15s ease;
      background: radial-gradient(circle at 50% 30%, rgba(255,255,255,.25), transparent 55%),
                  linear-gradient(120deg, rgba(255,100,180,.18), rgba(120,220,255,.12), rgba(255,230,140,.12));
      mix-blend-mode: screen;
      z-index: 999;
    }
    .overlay.show{
      opacity: 1;
      animation: overlayFlash 900ms ease-out 1;
    }
    @keyframes overlayFlash{
      0%{ opacity:0; transform: scale(1.02); }
      25%{ opacity:1; transform: scale(1.00); }
      100%{ opacity:0; transform: scale(1.02); }
    }

    /* ---------- login ---------- */
    .login-wrap{
      min-height: 100svh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px 16px;
    }
    .login{
      width:min(520px, 100%);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 18px;
      backdrop-filter: blur(10px);
      text-align:center;
    }
    .login h1{
      margin: 6px 0 10px;
      font-size: 22px;
      letter-spacing:.06em;
    }
    .login p{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }
    .login .field{
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .login input{
      width: min(320px, 100%);
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.28);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }
    .login .hint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,.7);
    }
    .error{
      margin-top: 10px;
      color: rgba(255,120,170,.95);
      font-weight: 800;
      display:none;
    }
    .error.show{ display:block; }

    /* tiny footer */
    .footer{
      text-align:center;
      margin-top: 16px;
      color: rgba(255,255,255,.55);
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="overlay" id="ultraOverlay"></div>

  <!-- LOGIN -->
  <section id="loginScreen" class="login-wrap">
    <div class="login">
      <h1>Restricted access</h1>
      <p>èº«å†…å°‚ç”¨ã€‚ã“ã“ã‹ã‚‰æŒã¡å‡ºã•ãªã„ã§ãã ã•ã„ã€‚</p>

      <div class="field">
        <input id="pw" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" autocomplete="off" />
        <button class="btn-pill" id="enterBtn">å…¥å®¤</button>
      </div>

      <div class="error" id="pwError">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã†ã£ã½ã„ã€‚</div>

      <div class="hint">â€»ã“ã‚Œã¯ã€Œå®Œå…¨é˜²å£ã€ã§ã¯ãªãã€Œèº«å†…ãƒãƒªç”¨ã®ç›®éš ã—ã€ã§ã™ã€‚</div>
    </div>
  </section>

  <!-- APP -->
  <section id="appScreen" style="display:none;">
    <div class="container">
      <div class="title">å…ƒæ°—å‡ºã›ã‚ˆã‚¬ãƒãƒ£</div>
      <div class="subtitle">ãƒœã‚¿ãƒ³æŠ¼ã—ã¦ã€å‡ºãŸã‚„ã¤å†ç”Ÿã—ã¦ã€å…ƒæ°—ã‚’å–ã‚Šè¿”ã›ã€‚</div>

      <div class="grid">
        <!-- GACHA 1 -->
        <div class="card">
          <h2>ğŸŒ¤ï¸ ã‚„ã•ã—ã‚</h2>

          <div class="row">
            <button class="btn-round" id="rollSoft">ã‚¬ãƒãƒ£</button>
            <button class="btn-play" id="playSoft" aria-label="å†ç”Ÿ">
              â–¶ å†ç”Ÿ
            </button>
          </div>

          <div class="result normal" id="resultSoft">
            <div class="fx rare"  data-fx="rare"></div>
            <div class="fx srare" data-fx="srare"></div>
            <div class="fx ssrare" data-fx="ssrare"></div>
            <div class="fx ultra" data-fx="ultra"></div>

            <div class="rarity" id="raritySoft">æœªæ’å‡º</div>
            <div class="name" id="nameSoft">â€”</div>
          </div>
        </div>

        <!-- GACHA 2 -->
        <div class="card">
          <h2>ğŸ”¥ å¼·ã‚</h2>

          <div class="row">
            <button class="btn-round" id="rollHard">ã‚¬ãƒãƒ£</button>
            <button class="btn-play" id="playHard" aria-label="å†ç”Ÿ">
              â–¶ å†ç”Ÿ
            </button>
          </div>

          <div class="result normal" id="resultHard">
            <div class="fx rare"  data-fx="rare"></div>
            <div class="fx srare" data-fx="srare"></div>
            <div class="fx ssrare" data-fx="ssrare"></div>
            <div class="fx ultra" data-fx="ultra"></div>

            <div class="rarity" id="rarityHard">æœªæ’å‡º</div>
            <div class="name" id="nameHard">â€”</div>
          </div>
        </div>
      </div>

      <div class="footer">
        Â© èº«å†…ãƒãƒªç§˜å¯†åŸºåœ° / â€œå…ƒæ°—å‡ºã›ã‚ˆâ€
      </div>
    </div>

    <audio id="player" preload="none"></audio>
  </section>

  <script>
    /***********************************************************
     * 0) ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆã“ã“ã ã‘æœ€åˆã«å¤‰ãˆã¦OKï¼‰
     ***********************************************************/
    const PASSWORD = "muhomuho"; // â†å¥½ãã«å¤‰ãˆã¦

    // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒï¼ˆåŒã˜ç«¯æœ«ãƒ»åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ãªã‚‰å†å…¥åŠ›çœç•¥ï¼‰
    const AUTH_KEY = "gacha_auth_ok_v1";

    /***********************************************************
     * 1) ãƒ¬ã‚¢ãƒªãƒ†ã‚£å®šç¾©ï¼ˆ5æ®µéšï¼‰
     ***********************************************************/
    const RARITY = {
      NORMAL:  { key:"normal",  label:"ãƒãƒ¼ãƒãƒ«",  weight: 62 },
      RARE:    { key:"rare",    label:"ãƒ¬ã‚¢",      weight: 22 },
      SRARE:   { key:"srare",   label:"Sãƒ¬ã‚¢",     weight: 10 },
      SSRARE:  { key:"ssrare",  label:"SSãƒ¬ã‚¢",    weight: 5  },
      ULTRA:   { key:"ultra",   label:"ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢", weight: 1 }
    };

    // weight ã¯ã€Œå‡ºã‚„ã™ã•ï¼ˆæ¯”ç‡ï¼‰ã€ï¼šåˆè¨ˆãŒ100ã˜ã‚ƒãªãã¦ã‚‚OKï¼ˆå†…éƒ¨ã§æ¯”ç‡æ‰±ã„ï¼‰

    /***********************************************************
     * 2) ã‚¬ãƒãƒ£ä¸­èº«ï¼ˆå¾Œã§ã“ã“ã ã‘å·®ã—æ›¿ãˆã‚Œã°OKï¼‰
     *    - file: å®Ÿãƒ•ã‚¡ã‚¤ãƒ«åï¼ˆãƒ‘ã‚¹å«ã‚€ï¼‰
     *    - title: ç”»é¢ã«å‡ºã™è¡¨ç¤ºåï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã¨åˆ¥ã§OKï¼‰
     *    - rarity: RARITYã®key
     ***********************************************************/
    const POOL_SOFT = [
      // --- ãƒãƒ¼ãƒãƒ« ---
      { file:"assets/audio/bougen/a001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚1", rarity:"normal" },
      { file:"assets/audio/bougen/a002.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚2", rarity:"normal" },
      { file:"assets/audio/bougen/a003.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚3", rarity:"normal" },

      // --- ãƒ¬ã‚¢ ---
      { file:"assets/audio/bougen/r001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚ãƒ¬ã‚¢1", rarity:"rare" },

      // --- Sãƒ¬ã‚¢ ---
      { file:"assets/audio/bougen/s001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚Sãƒ¬ã‚¢1", rarity:"srare" },

      // --- SSãƒ¬ã‚¢ ---
      { file:"assets/audio/bougen/ss001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚SSãƒ¬ã‚¢1", rarity:"ssrare" },

      // --- ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢ ---
      { file:"assets/audio/bougen/u001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰ã‚„ã•ã—ã‚ã‚¦ãƒ«ãƒˆãƒ©", rarity:"ultra" },
    ];

    const POOL_HARD = [
      // --- ãƒãƒ¼ãƒãƒ« ---
      { file:"assets/audio/simoneta/a001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚1", rarity:"normal" },
      { file:"assets/audio/simoneta/a002.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚2", rarity:"normal" },
      { file:"assets/audio/simoneta/a003.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚3", rarity:"normal" },

      // --- ãƒ¬ã‚¢ ---
      { file:"assets/audio/simoneta/r001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚ãƒ¬ã‚¢1", rarity:"rare" },

      // --- Sãƒ¬ã‚¢ ---
      { file:"assets/audio/simoneta/s001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚Sãƒ¬ã‚¢1", rarity:"srare" },

      // --- SSãƒ¬ã‚¢ ---
      { file:"assets/audio/simoneta/ss001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚SSãƒ¬ã‚¢1", rarity:"ssrare" },

      // --- ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢ ---
      { file:"assets/audio/simoneta/u001.mp3", title:"ï¼ˆè¡¨ç¤ºåï¼‰å¼·ã‚ã‚¦ãƒ«ãƒˆãƒ©", rarity:"ultra" },
    ];

    /***********************************************************
     * 3) ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
     ***********************************************************/
    function pickWeightedRarity(){
      const list = Object.values(RARITY);
      const total = list.reduce((a,b)=>a + b.weight, 0);
      let r = Math.random() * total;
      for (const it of list){
        r -= it.weight;
        if (r <= 0) return it.key;
      }
      return "normal";
    }

    function pickFromPoolByRarity(pool, rarityKey){
      const filtered = pool.filter(x => x.rarity === rarityKey);
      if (filtered.length === 0) return null;
      return filtered[Math.floor(Math.random() * filtered.length)];
    }

    function roll(pool){
      // ã¾ãšãƒ¬ã‚¢ãƒªãƒ†ã‚£æŠ½é¸ â†’ ãã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®ä¸­ã‹ã‚‰1ã¤
      // ã‚‚ã—ãã®ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã®å¼¾ãŒ0ãªã‚‰ã€ä¸‹ã®ãƒ¬ã‚¢ã¸ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
      const order = ["ultra","ssrare","srare","rare","normal"];

      let rarityKey = pickWeightedRarity();
      let idx = order.indexOf(rarityKey);
      if (idx < 0) idx = order.length - 1;

      for (let i = idx; i < order.length; i++){
        const got = pickFromPoolByRarity(pool, order[i]);
        if (got) return got;
      }
      // ã©ã†ã—ã¦ã‚‚ç„¡ã„å ´åˆ
      return pool[0] ?? { file:"", title:"(ç©º)", rarity:"normal" };
    }

    function setResultUI(ui, item){
      // ui: soft/hard set
      ui.rarityEl.textContent = rarityLabel(item.rarity);
      ui.nameEl.textContent = item.title;

      ui.resultBox.className = "result " + item.rarity;

      // fxè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
      ui.resultBox.querySelectorAll(".fx").forEach(el => {
        const fx = el.getAttribute("data-fx");
        el.style.display = (fx === item.rarity) ? "block" : "none";
      });

      // play button enable
      ui.lastFile = item.file;
      ui.playBtn.classList.add("show");

      // Ultraç¢ºå®šæ¼”å‡ºï¼ˆæ´¾æ‰‹ï¼‰
      if (item.rarity === "ultra"){
        ultraShow();
      }
    }

    function rarityLabel(key){
      switch(key){
        case "rare": return "ãƒ¬ã‚¢";
        case "srare": return "Sãƒ¬ã‚¢";
        case "ssrare": return "SSãƒ¬ã‚¢";
        case "ultra": return "ã‚¦ãƒ«ãƒˆãƒ©ãƒ¬ã‚¢";
        default: return "ãƒãƒ¼ãƒãƒ«";
      }
    }

    function ultraShow(){
      const ov = document.getElementById("ultraOverlay");
      ov.classList.remove("show");
      // reflow
      void ov.offsetWidth;
      ov.classList.add("show");
      setTimeout(()=>ov.classList.remove("show"), 950);
    }

    /
    ***********************************************************
     * 4) ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªå†ç”Ÿ
     ***********************************************************/
    const player = document.getElementById("player");

    async function playFile(path){
      if (!path) return;
      try{
        // é€£ç¶šå†ç”Ÿæ™‚ã®ãƒãƒ©ã¤ãé˜²æ­¢
        player.pause();
        player.currentTime = 0;
        player.src = path;

        // iOS/Androidã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã‹ã‚‰ã®playãŒå¿…è¦ãªã®ã§
        // ã€Œå†ç”Ÿãƒœã‚¿ãƒ³ã€æŠ¼ä¸‹æ™‚ã«ã ã‘å‘¼ã°ã‚Œã‚‹æƒ³å®š
        await player.play();
      }catch(e){
        // ãƒ–ãƒ©ã‚¦ã‚¶åˆ¶é™ / ãƒ‘ã‚¹é–“é•ã„ / æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ãªã©
        alert("å†ç”Ÿã§ããªã‹ã£ãŸï¼\nãƒ•ã‚¡ã‚¤ãƒ«å/ãƒ‘ã‚¹ãŒåˆã£ã¦ã‚‹ã‹ã€éŸ³å£°ãŒã‚¢ãƒƒãƒ—æ¸ˆã¿ã‹ç¢ºèªã—ã¦ã­ã€‚\n\n" + (e?.message ?? ""));
      }
    }

    /***********************************************************
     * 5) ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
     ***********************************************************/
    const loginScreen = document.getElementById("loginScreen");
    const appScreen = document.getElementById("appScreen");
    const pwInput = document.getElementById("pw");
    const enterBtn = document.getElementById("enterBtn");
    const pwError = document.getElementById("pwError");

    function unlock(){
      localStorage.setItem(AUTH_KEY, "1");
      loginScreen.style.display = "none";
      appScreen.style.display = "block";
    }

    function lock(){
      localStorage.removeItem(AUTH_KEY);
      loginScreen.style.display = "flex";
      appScreen.style.display = "none";
    }

    function tryLogin(){
      const v = pwInput.value ?? "";
      if (v === PASSWORD){
        pwError.classList.remove("show");
        unlock();
      }else{
        pwError.classList.add("show");
      }
    }

    enterBtn.addEventListener("click", tryLogin);
    pwInput.addEventListener("keydown", (e)=>{
      if (e.key === "Enter") tryLogin();
    });

    // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
    if (localStorage.getItem(AUTH_KEY) === "1"){
      unlock();
    }else{
      lock();
    }

    /***********************************************************
     * 6) ã‚¬ãƒãƒ£UIç´ä»˜ã‘ï¼ˆ2ã¤ï¼‰
     ***********************************************************/
    function makeUI(prefix){
      return {
        resultBox: document.getElementById("result" + prefix),
        rarityEl: document.getElementById("rarity" + prefix),
        nameEl:   document.getElementById("name" + prefix),
        rollBtn:  document.getElementById("roll" + prefix),
        playBtn:  document.getElementById("play" + prefix),
        lastFile: ""
      };
    }

    const uiSoft = makeUI("Soft");
    const uiHard = makeUI("Hard");

    uiSoft.rollBtn.addEventListener("click", ()=>{
      const item = roll(POOL_SOFT);
      setResultUI(uiSoft, item);
    });
    uiHard.rollBtn.addEventListener("click", ()=>{
      const item = roll(POOL_HARD);
      setResultUI(uiHard, item);
    });

    uiSoft.playBtn.addEventListener("click", ()=> playFile(uiSoft.lastFile));
    uiHard.playBtn.addEventListener("click", ()=> playFile(uiHard.lastFile));
  </script>
</body>
</html>
